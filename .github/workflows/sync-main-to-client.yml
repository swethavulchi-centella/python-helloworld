name: Manual Sync main -> client main

on:
  workflow_dispatch:    # manual trigger

jobs:
  sync:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout company repo main
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
          ref: main

      - name: Add client remote and push
        env:
          CLIENT_PAT: ${{ secrets.CLIENT_PAT }}
        run: |
          # 1) Ensure PAT is present
          if [ -z "$CLIENT_PAT" ]; then
            echo "CLIENT_PAT secret is not set. Please add it in repo settings."
            exit 1
          fi

          # 2) Remove the auth header that checkout set for github.com
          #    (this is what forces github-actions[bot] auth)
          git config --unset-all http.https://github.com/.extraheader || true

          # 3) Clean up any existing 'client' remote if rerun
          git remote remove client || true

          # 4) Add client repo as remote using USERNAME:PAT
          git remote add client https://$GITHUB_ACTOR:$CLIENT_PAT@github.com/swethavulchi-centella/python-helloworld.git

          echo "Configured remotes:"
          git remote -v

          echo "Pushing company main -> client main"
          git push client main:main
